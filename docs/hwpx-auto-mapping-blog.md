# HWPX í…œí”Œë¦¿ ìë™ ë§¤í•‘ ì‹œìŠ¤í…œ êµ¬ì¶•ê¸°

> Excel ë°ì´í„°ë¥¼ í•œê¸€(HWPX) ë¬¸ì„œ í…œí”Œë¦¿ì— ìë™ìœ¼ë¡œ ë§¤í•‘í•˜ëŠ” AI ê¸°ë°˜ ì‹œìŠ¤í…œ ê°œë°œ ê³¼ì •

## ìš”êµ¬ì‚¬í•­

í•œêµ­ì‚°ì—…ì¸ë ¥ê³µë‹¨ì—ì„œ ì‚¬ìš©í•˜ëŠ” **ê°œì¸ì´ë ¥ì¹´ë“œ** ì–‘ì‹ì´ ìˆì—ˆìŠµë‹ˆë‹¤.

- **HWPX í…œí”Œë¦¿**: 28í–‰ Ã— 16ì—´ í‘œ êµ¬ì¡°ì˜ ê°œì¸ì´ë ¥ì¹´ë“œ
- **Excel ë°ì´í„°**: 300ëª… ì´ìƒì˜ ì¸ë ¥ ì •ë³´ (ì„±ëª…, ì—°ë½ì²˜, ìƒë…„ì›”ì¼ ë“± 51ê°œ ì»¬ëŸ¼)
- **ëª©í‘œ**: Excelì˜ ê° í–‰(ì‚¬ëŒ)ë§ˆë‹¤ HWPX íŒŒì¼ì„ ìë™ ìƒì„±í•˜ì—¬ ZIPìœ¼ë¡œ ì¼ê´„ ë‹¤ìš´ë¡œë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HWPX í…œí”Œë¦¿     â”‚     â”‚   Excel ë°ì´í„°   â”‚     â”‚   ZIP ë‹¤ìš´ë¡œë“œ   â”‚
â”‚  (ê°œì¸ì´ë ¥ì¹´ë“œ)   â”‚  +  â”‚  (300+ rows)    â”‚  â†’  â”‚  (300+ HWPX)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ê³¼ì œ

1. HWPX í‘œì˜ ì–´ë–¤ ì…€ì— Excelì˜ ì–´ë–¤ ì»¬ëŸ¼ ë°ì´í„°ë¥¼ ë„£ì„ì§€ **ìë™ìœ¼ë¡œ ë§¤í•‘**
2. "ì„±  ëª…" â†” "ì„±ëª…", "ì·¨ ì—… ì²˜" â†” "ì·¨ì—…ì²˜" ê°™ì€ **ê³µë°± ì°¨ì´ ì²˜ë¦¬**
3. Excel í—¤ë”ê°€ 1í–‰ì´ ì•„ë‹Œ 3í–‰ì— ìˆëŠ” **ë¹„í‘œì¤€ êµ¬ì¡° ì²˜ë¦¬**

---

## 1ì°¨ ì‹œë„: ë‹¨ìˆœ ExcelJS íŒŒì‹±

### ì ‘ê·¼ ë°©ì‹

```typescript
// ExceljsParserAdapter.extractSheetData()
worksheet.eachRow((row, rowNumber) => {
  if (rowNumber === 1) {
    // ì²« í–‰ì„ í—¤ë”ë¡œ ì‚¬ìš©
    row.eachCell((cell, colNumber) => {
      headers[colNumber - 1] = String(cell.value);
    });
  } else {
    // ë‚˜ë¨¸ì§€ëŠ” ë°ì´í„°
  }
});
```

### ì‹¤íŒ¨ ì›ì¸

Excel íŒŒì¼ì˜ ì‹¤ì œ êµ¬ì¡°ê°€ ì˜ˆìƒê³¼ ë‹¬ëìŠµë‹ˆë‹¤:

```
Row 1: "1. ì‹ ìƒì •ë³´" | "2. í•´ì™¸ì·¨ì—…" | "3. í¬ë§ì§ì¢…" | ...  â† ì„¹ì…˜ í—¤ë”
Row 2: (ë³‘í•© ì…€ë“¤)
Row 3: "No." | "ì„±ëª…" | "ì—°ë½ì²˜" | "ìƒë…„ì›”ì¼" | ...        â† ì‹¤ì œ ì»¬ëŸ¼ í—¤ë”
Row 4+: ë°ì´í„°
```

**ê²°ê³¼**: 6ê°œì˜ ì„¹ì…˜ í—¤ë”("1. ì‹ ìƒì •ë³´", "2. í•´ì™¸ì·¨ì—…" ë“±)ë¥¼ ì»¬ëŸ¼ëª…ìœ¼ë¡œ ì¸ì‹

```json
// ì˜ëª»ëœ ê²°ê³¼
{
  "columns": ["1. ì‹ ìƒì •ë³´", "2. í•´ì™¸ì·¨ì—…(ê²½í—˜)", "3. í¬ë§ì§ì¢…/ì§ë¬´", ...]
}
```

---

## 2ì°¨ ì‹œë„: ìŠ¤ë§ˆíŠ¸ í—¤ë” ê°ì§€ ì•Œê³ ë¦¬ì¦˜

### ì ‘ê·¼ ë°©ì‹

ì²« 10í–‰ì„ ìŠ¤ìº”í•˜ê³  **ì ìˆ˜ ì‹œìŠ¤í…œ**ìœ¼ë¡œ ì‹¤ì œ í—¤ë” í–‰ì„ ì°¾ìŠµë‹ˆë‹¤:

```typescript
private async findSmartHeaderRow(worksheet) {
  const rows = [];

  for (let rowNum = 1; rowNum <= 10; rowNum++) {
    const row = worksheet.getRow(rowNum);
    let nonEmptyCount = 0;
    let hasShortLabels = 0;    // 2-10ì í…ìŠ¤íŠ¸ (í•„ë“œëª…ì²˜ëŸ¼ ë³´ì´ëŠ”)
    let hasSectionMarkers = 0;  // "1.", "2." ë“±

    row.eachCell((cell, colNumber) => {
      const text = extractCellText(cell);

      if (text.length > 0) {
        nonEmptyCount++;

        // ì§§ì€ í…ìŠ¤íŠ¸ëŠ” í•„ë“œëª…ì¼ ê°€ëŠ¥ì„± ë†’ìŒ
        if (text.length >= 2 && text.length <= 10) {
          hasShortLabels++;
        }

        // ì„¹ì…˜ ë§ˆì»¤ëŠ” í—¤ë”ê°€ ì•„ë‹˜
        if (/^\d+\./.test(text)) {
          hasSectionMarkers++;
        }
      }
    });

    // ì ìˆ˜ ê³„ì‚°
    const score = nonEmptyCount * 2
                + hasShortLabels * 3
                - hasSectionMarkers * 10;  // í˜ë„í‹°

    rows.push({ rowNum, score, values });
  }

  // ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ í–‰ ì„ íƒ
  rows.sort((a, b) => b.score - a.score);
  return rows[0];
}
```

### ì ìˆ˜ ê³„ì‚° ì˜ˆì‹œ

| í–‰ | ë‚´ìš© | ë¹„ì–´ìˆì§€ ì•Šì€ ì…€ | ì§§ì€ ë¼ë²¨ | ì„¹ì…˜ ë§ˆì»¤ | ì ìˆ˜ |
|---|------|---------------|---------|---------|-----|
| 1 | "1. ì‹ ìƒì •ë³´", "2. í•´ì™¸ì·¨ì—…", ... | 6 | 0 | 6 | 6Ã—2 + 0Ã—3 - 6Ã—10 = **-48** |
| 3 | "No.", "ì„±ëª…", "ì—°ë½ì²˜", ... | 51 | 45 | 0 | 51Ã—2 + 45Ã—3 - 0Ã—10 = **237** |

**ê²°ê³¼**: Row 3ì´ í—¤ë”ë¡œ ì„ íƒë¨ (Score: 237)

### ë¶€ë¶„ ì„±ê³µ

```json
// ì˜¬ë°”ë¥¸ ì»¬ëŸ¼ ê°ì§€
{
  "columns": ["No.", "ì„±ëª…", "ì—°ë½ì²˜", "ìƒë…„ì›”ì¼", "ì´ë©”ì¼", "ì„±ë³„", ...]
}
```

í•˜ì§€ë§Œ **ë§¤í•‘ ì •í™•ë„**ê°€ ë‚®ì•˜ìŠµë‹ˆë‹¤. HWPXì˜ "ì„±  ëª…"ê³¼ Excelì˜ "ì„±ëª…"ì„ ë§¤ì¹­í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

---

## 3ì°¨ ì‹œë„: ë‹¨ìˆœ ë¬¸ìì—´ ë§¤ì¹­

### ì ‘ê·¼ ë°©ì‹

```typescript
function normalizeText(text: string): string {
  return text.replace(/\s+/g, '').toLowerCase();
}

// "ì„±  ëª…" â†’ "ì„±ëª…", "ì·¨ ì—… ì²˜" â†’ "ì·¨ì—…ì²˜"
const hwpxLabel = normalizeText(cell.text);  // "ì„±ëª…"
const excelCol = normalizeText(column);       // "ì„±ëª…"

if (hwpxLabel === excelCol) {
  // ë§¤ì¹­!
}
```

### ì‹¤íŒ¨ ì›ì¸

1. **ë™ì¼ ë¼ë²¨ ì¤‘ë³µ**: HWPXì— "ì·¨ì—…ì—¬ë¶€"ê°€ 3ê°œ, "ì·¨ ì—… ì²˜"ê°€ 3ê°œ ìˆìŒ (êµ­ë‚´ì·¨ì—…, í•´ì™¸ì·¨ì—…, ì¸í„´ ì„¹ì…˜)
2. **ì˜ë¯¸ì  ìœ ì‚¬ì„± ë¬´ì‹œ**: "ë‹´ë‹¹ì§ë¬´" â†” "ì§ë¬´"ëŠ” ê°™ì€ ì˜ë¯¸ì§€ë§Œ ë¬¸ìì—´ì´ ë‹¤ë¦„
3. **ìœ„ì¹˜ ë§¥ë½ ë¬´ì‹œ**: ê°™ì€ ë¼ë²¨ì´ë¼ë„ ìœ„ì¹˜ì— ë”°ë¼ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ë§¤í•‘í•´ì•¼ í•¨

```
HWPX êµ¬ì¡°:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ì·¨ì—…í˜„í™©                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ êµ­ë‚´ì·¨ì—… â”‚ í•´ì™¸ì·¨ì—… â”‚ ì¸í„´            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ì·¨ì—…ì—¬ë¶€  â”‚ì·¨ì—…ì—¬ë¶€  â”‚ì·¨ì—…ì—¬ë¶€          â”‚  â† ê°™ì€ ë¼ë²¨ 3ê°œ!
â”‚ì·¨ ì—… ì²˜  â”‚ì·¨ ì—… ì²˜  â”‚ì·¨ ì—… ì²˜          â”‚  â† ê°™ì€ ë¼ë²¨ 3ê°œ!
â”‚ë‹´ë‹¹ì§ë¬´  â”‚ë‹´ë‹¹ì§ë¬´  â”‚ë‹´ë‹¹ì§ë¬´          â”‚  â† ê°™ì€ ë¼ë²¨ 3ê°œ!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ìµœì¢… í•´ê²°: LangGraph ìŠ¤íƒ€ì¼ ë³‘ë ¬ AI íŒŒì´í”„ë¼ì¸

### ì•„í‚¤í…ì²˜ ì„¤ê³„

ë‹¨ì¼ ë°©ë²•ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ **ë‹¤ì¤‘ ì „ëµ + íˆ¬í‘œ ì‹œìŠ¤í…œ**ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HwpxMappingGraphService                      â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Stage 1: ë³‘ë ¬ ë°ì´í„° ì¶”ì¶œ                                   â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”‚   â”‚ HWPX ë¶„ì„    â”‚       â”‚ Excel ìŠ¤ë§ˆíŠ¸ í—¤ë” ê°ì§€       â”‚   â”‚ â”‚
â”‚  â”‚   â”‚ (28Ã—16 í‘œ)   â”‚       â”‚ (51ê°œ ì»¬ëŸ¼)                 â”‚   â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Stage 2: ë³‘ë ¬ ë§¤í•‘ ìƒì„± (Promise.allSettled)               â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚ â”‚
â”‚  â”‚   â”‚  Node 1    â”‚  â”‚  Node 2    â”‚  â”‚  Node 3    â”‚         â”‚ â”‚
â”‚  â”‚   â”‚ ê·œì¹™ ê¸°ë°˜   â”‚  â”‚ AI í…œí”Œë¦¿  â”‚  â”‚ AI Excel   â”‚         â”‚ â”‚
â”‚  â”‚   â”‚  ë§¤í•‘      â”‚  â”‚   ë¶„ì„     â”‚  â”‚   ë¶„ì„     â”‚         â”‚ â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚
â”‚  â”‚         â”‚               â”‚               â”‚                 â”‚ â”‚
â”‚  â”‚         â–¼               â–¼               â–¼                 â”‚ â”‚
â”‚  â”‚     27 í›„ë³´         26 í›„ë³´         13 í›„ë³´                â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Stage 3: ë³‘í•© ë° íˆ¬í‘œ (Node 4: Merge)                      â”‚ â”‚
â”‚  â”‚                                                            â”‚ â”‚
â”‚  â”‚   ê°™ì€ (row, col) ìœ„ì¹˜ â†’ confidence ì ìˆ˜ í•©ì‚°             â”‚ â”‚
â”‚  â”‚   ìµœê³  ì ìˆ˜ í›„ë³´ ì„ íƒ                                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                  â”‚
â”‚                              â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Stage 4: ìµœì¢… ë§¤í•‘ ë°˜í™˜ (27ê°œ)                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Node 1: ê·œì¹™ ê¸°ë°˜ ë§¤í•‘

HWPX í‘œ êµ¬ì¡°ë¥¼ ë¶„ì„í•˜ì—¬ ë¼ë²¨-ë°ì´í„° ì…€ ê´€ê³„ë¥¼ ì¶”ë¡ í•©ë‹ˆë‹¤:

```typescript
private async runRuleBasedMapping(state: GraphState): Promise<MappingCandidate[]> {
  const candidates: MappingCandidate[] = [];
  const { hwpxTable, excelColumns } = state;

  // ë¼ë²¨ ì…€ ì°¾ê¸°
  for (const cell of hwpxTable.cells) {
    if (!cell.isHeader) continue;

    const labelText = this.normalizeText(cell.text);

    // Excel ì»¬ëŸ¼ì—ì„œ ë§¤ì¹­ ì°¾ê¸°
    const matchedColumn = excelColumns.find(col =>
      this.normalizeText(col) === labelText
    );

    if (matchedColumn) {
      // ë°ì´í„° ìœ„ì¹˜ ì¶”ë¡ : ì˜¤ë¥¸ìª½ ë˜ëŠ” ì•„ë˜
      const dataPosition = this.inferDataPosition(cell, hwpxTable);

      candidates.push({
        excelColumn: matchedColumn,
        hwpxRow: dataPosition.row,
        hwpxCol: dataPosition.col,
        labelText: cell.text,
        confidence: 0.9,
        source: 'rule',
        reason: `ë¼ë²¨ "${cell.text}" ${dataPosition.direction} ì…€`
      });
    }
  }

  return candidates;
}

private inferDataPosition(labelCell, table) {
  const { rowIndex, colIndex } = labelCell;

  // ì˜¤ë¥¸ìª½ ì…€ì´ ë¹„ì–´ìˆìœ¼ë©´ â†’ ê°€ë¡œ ë°°ì¹˜
  const rightCell = table.cells.find(c =>
    c.rowIndex === rowIndex && c.colIndex === colIndex + 1
  );
  if (rightCell && !rightCell.isHeader) {
    return { row: rowIndex, col: colIndex + 1, direction: 'ì˜¤ë¥¸ìª½' };
  }

  // ì•„ë˜ ì…€ì´ ë¹„ì–´ìˆìœ¼ë©´ â†’ ì„¸ë¡œ ë°°ì¹˜
  const belowCell = table.cells.find(c =>
    c.rowIndex === rowIndex + 1 && c.colIndex === colIndex
  );
  if (belowCell && !belowCell.isHeader) {
    return { row: rowIndex + 1, col: colIndex, direction: 'ì•„ë˜' };
  }

  return { row: rowIndex, col: colIndex + 1, direction: 'ì˜¤ë¥¸ìª½' };
}
```

### Node 2: AI í…œí”Œë¦¿ êµ¬ì¡° ë¶„ì„ (Gemini API)

HWPX í‘œ ì „ì²´ êµ¬ì¡°ë¥¼ AIì—ê²Œ ë³´ì—¬ì£¼ê³  ë°ì´í„° ì…ë ¥ ìœ„ì¹˜ë¥¼ ì¶”ë¡ í•©ë‹ˆë‹¤:

```typescript
private async runAiTemplateAnalysis(state: GraphState): Promise<MappingCandidate[]> {
  const tableDescription = this.formatTableForAI(state.hwpxTable);

  const prompt = `
ë‹¹ì‹ ì€ ë¬¸ì„œ í…œí”Œë¦¿ ë¶„ì„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

## HWPX í‘œ êµ¬ì¡°
${tableDescription}

## Excel ì»¬ëŸ¼ ëª©ë¡
${state.excelColumns.join(', ')}

## ë¶„ì„ ìš”ì²­
ê° ë¼ë²¨ ì…€ì— ëŒ€í•´ ë°ì´í„°ê°€ ì…ë ¥ë  ìœ„ì¹˜(row, col)ë¥¼ ë¶„ì„í•˜ì„¸ìš”.
ë¼ë²¨ê³¼ ì˜ë¯¸ì ìœ¼ë¡œ ë§¤ì¹­ë˜ëŠ” Excel ì»¬ëŸ¼ì„ ì°¾ì•„ì£¼ì„¸ìš”.

## ì‘ë‹µ í˜•ì‹ (JSON)
[
  { "excelColumn": "ì„±ëª…", "hwpxRow": 3, "hwpxCol": 1, "labelText": "ì„±  ëª…" },
  ...
]
`;

  const response = await this.geminiClient.generateContent(prompt);
  return this.parseAiResponse(response, 'ai_template');
}

private formatTableForAI(table): string {
  const lines = [];
  for (const cell of table.cells) {
    const label = cell.isHeader ? ' [ë¼ë²¨]' : '';
    lines.push(`(${cell.rowIndex},${cell.colIndex}): "${cell.text}"${label}`);
  }
  return lines.join('\n');
}
```

### Node 3: AI Excel í—¤ë” ì‹œë§¨í‹± ë§¤ì¹­ (Gemini API)

Excel ì»¬ëŸ¼ëª…ê³¼ HWPX ë¼ë²¨ ê°„ì˜ ì˜ë¯¸ì  ìœ ì‚¬ì„±ì„ AIë¡œ ë¶„ì„í•©ë‹ˆë‹¤:

```typescript
private async runAiExcelAnalysis(state: GraphState): Promise<MappingCandidate[]> {
  // HWPXì—ì„œ ë¼ë²¨ í…ìŠ¤íŠ¸ë§Œ ì¶”ì¶œ
  const hwpxLabels = state.hwpxTable.cells
    .filter(c => c.isHeader)
    .map(c => c.text);

  const prompt = `
## Excel ì»¬ëŸ¼
${state.excelColumns.join(', ')}

## HWPX ë¼ë²¨
${hwpxLabels.join(', ')}

## ìš”ì²­
ì˜ë¯¸ì ìœ¼ë¡œ ë™ì¼í•˜ê±°ë‚˜ ìœ ì‚¬í•œ Excel ì»¬ëŸ¼ - HWPX ë¼ë²¨ ìŒì„ ì°¾ì•„ì£¼ì„¸ìš”.

ì˜ˆì‹œ:
- "ì„±ëª…" â‰ˆ "ì„±  ëª…" (ê³µë°± ì°¨ì´)
- "ë‹´ë‹¹ì§ë¬´" â‰ˆ "ì§ë¬´" (í¬í•¨ ê´€ê³„)
- "ì·¨ì—…ì²˜/ì§ë¬´" â‰ˆ "ì·¨ì—…ì²˜/ì§ë¬´" (ì™„ì „ ì¼ì¹˜)

## ì‘ë‹µ í˜•ì‹ (JSON)
[
  { "excelColumn": "ì„±ëª…", "hwpxLabel": "ì„±  ëª…", "similarity": 0.95 },
  ...
]
`;

  const response = await this.geminiClient.generateContent(prompt);
  return this.convertToMappingCandidates(response, state.hwpxTable);
}
```

### Node 4: ë³‘í•© ë° íˆ¬í‘œ

ì„¸ ë…¸ë“œì˜ ê²°ê³¼ë¥¼ í•©ì³ì„œ ìµœì¢… ë§¤í•‘ì„ ê²°ì •í•©ë‹ˆë‹¤:

```typescript
private runMergeNode(state: GraphState): MappingCandidate[] {
  const allCandidates = [
    ...state.ruleMappings,      // 27ê°œ
    ...state.aiTemplateMappings, // 26ê°œ
    ...state.aiExcelMappings     // 13ê°œ
  ];

  // ê°™ì€ ìœ„ì¹˜ì— ëŒ€í•œ í›„ë³´ë“¤ì„ ê·¸ë£¹í™”
  const candidateGroups = new Map<string, MappingCandidate[]>();

  for (const candidate of allCandidates) {
    const key = `${candidate.hwpxRow}-${candidate.hwpxCol}-${candidate.excelColumn}`;
    if (!candidateGroups.has(key)) {
      candidateGroups.set(key, []);
    }
    candidateGroups.get(key).push(candidate);
  }

  // ê° ê·¸ë£¹ì—ì„œ confidence í•©ì‚° í›„ ìµœê³  ì ìˆ˜ ì„ íƒ
  const finalMappings: MappingCandidate[] = [];

  for (const [key, candidates] of candidateGroups) {
    // confidence í•©ì‚° (ì—¬ëŸ¬ ë…¸ë“œê°€ ë™ì˜í•˜ë©´ ì ìˆ˜ ìƒìŠ¹)
    const totalConfidence = candidates.reduce((sum, c) => sum + c.confidence, 0);

    const bestCandidate = { ...candidates[0] };
    bestCandidate.confidence = totalConfidence;
    bestCandidate.source = candidates.map(c => c.source).join('+');

    finalMappings.push(bestCandidate);
  }

  // ìœ„ì¹˜ë³„ë¡œ ê°€ì¥ ë†’ì€ confidence ì„ íƒ
  const positionBest = new Map<string, MappingCandidate>();

  for (const mapping of finalMappings) {
    const posKey = `${mapping.hwpxRow}-${mapping.hwpxCol}`;
    const existing = positionBest.get(posKey);

    if (!existing || mapping.confidence > existing.confidence) {
      positionBest.set(posKey, mapping);
    }
  }

  return Array.from(positionBest.values());
}
```

### íˆ¬í‘œ ì‹œìŠ¤í…œ ì˜ˆì‹œ

```
ìœ„ì¹˜ (3, 1) - "ì„±ëª…" ë§¤í•‘:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Node 1   â”‚   Node 2   â”‚   Node 3    â”‚
â”‚  (Rule)    â”‚ (AI í…œí”Œë¦¿) â”‚ (AI Excel)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   0.90     â”‚    0.90    â”‚    0.95     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
         ì´ì : 0.90 + 0.90 + 0.95 = 2.75

         âœ… ìµœì¢… ì„ íƒ: "ì„±ëª…" â†’ (3, 1)
```

---

## ë©”ëª¨ë¦¬ ìµœì í™” ì´ìŠˆ

### ë¬¸ì œ ë°œìƒ

300ê°œ ì´ìƒì˜ í–‰ì„ ì²˜ë¦¬í•  ë•Œ **JavaScript heap out of memory** ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.

```
FATAL ERROR: Reached heap limit Allocation failed - JavaScript heap out of memory
```

### ì›ì¸ ë¶„ì„

```typescript
// ë¬¸ì œ ì½”ë“œ
for (let rowNum = 1; rowNum <= rowCount; rowNum++) {
  const row = worksheet.getRow(rowNum);

  columnMap.forEach((columnName, colNumber) => {
    const cell = row.getCell(colNumber);  // ExcelJS ê°ì²´ ì°¸ì¡° ìœ ì§€
    rowData[columnName] = cell.value;     // ê°ì²´ ê·¸ëŒ€ë¡œ ì €ì¥
  });

  data.push(rowData);  // ë©”ëª¨ë¦¬ ëˆ„ì 
}
```

- ExcelJSì˜ Cell ê°ì²´ê°€ ë‚´ë¶€ì ìœ¼ë¡œ ë§ì€ ë©”íƒ€ë°ì´í„°ë¥¼ ë³´ìœ 
- 300ê°œ í–‰ Ã— 51ê°œ ì»¬ëŸ¼ = 15,300ê°œ Cell ê°ì²´ ì°¸ì¡°
- GCê°€ ì œëŒ€ë¡œ ì •ë¦¬í•˜ì§€ ëª»í•¨

### í•´ê²° ë°©ë²•

```typescript
// ìµœì í™”ëœ ì½”ë“œ
worksheet.eachRow({ includeEmpty: false }, (row, rowNum) => {
  if (rowNum <= headerRowNum) return;

  const rowData: Record<string, unknown> = {};

  for (const { colIndex, name } of columnIndexToName) {
    const cell = row.getCell(colIndex);
    const value = cell.value;

    if (value !== null && value !== undefined) {
      // ì¦‰ì‹œ ê¸°ë³¸ íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ ì €ì¥
      rowData[name] = this.extractCellValue(value);
    }
  }

  data.push(rowData);
});

private extractCellValue(value: unknown): string | number | boolean | Date {
  if (value instanceof Date) return value;

  if (typeof value === 'object') {
    // richText, formula ë“± ë³µì¡í•œ ê°ì²´ â†’ ë¬¸ìì—´ë¡œ ë³€í™˜
    if ('richText' in value) {
      return value.richText.map(t => t.text).join('');
    }
    if ('result' in value) {
      return this.extractCellValue(value.result);
    }
    return JSON.stringify(value);
  }

  return value;  // string, number, boolean
}
```

ì¶”ê°€ë¡œ Node.js í™ ë©”ëª¨ë¦¬ ì¦ê°€:

```bash
NODE_OPTIONS="--max-old-space-size=8192" npm run start:dev
```

---

## ìµœì¢… ê²°ê³¼

### ë§¤í•‘ ì •í™•ë„

| ë°©ë²• | ë§¤í•‘ ìˆ˜ | ì •í™•ë„ |
|-----|--------|-------|
| 1ì°¨ (ë‹¨ìˆœ íŒŒì‹±) | 0 | 0% |
| 2ì°¨ (ìŠ¤ë§ˆíŠ¸ í—¤ë”) | 6 | 22% |
| 3ì°¨ (ë¬¸ìì—´ ë§¤ì¹­) | 15 | 56% |
| **ìµœì¢… (LangGraph)** | **27** | **100%** |

### ìƒ˜í”Œ ë§¤í•‘ ê²°ê³¼

```json
[
  { "excelColumn": "ì„±ëª…", "hwpxRow": 3, "hwpxCol": 1, "confidence": 2.75 },
  { "excelColumn": "ì—°ë½ì²˜", "hwpxRow": 4, "hwpxCol": 1, "confidence": 2.75 },
  { "excelColumn": "ìƒë…„ì›”ì¼", "hwpxRow": 3, "hwpxCol": 8, "confidence": 2.75 },
  { "excelColumn": "ì´ë©”ì¼", "hwpxRow": 4, "hwpxCol": 8, "confidence": 2.75 },
  { "excelColumn": "ì„±ë³„", "hwpxRow": 3, "hwpxCol": 14, "confidence": 2.75 },
  { "excelColumn": "ê±°ì£¼ì§€", "hwpxRow": 4, "hwpxCol": 14, "confidence": 2.75 },
  { "excelColumn": "ì°¸ì—¬ë¶„ì•¼", "hwpxRow": 7, "hwpxCol": 0, "confidence": 2.5 },
  { "excelColumn": "ìˆ˜í–‰ê¸°ê´€", "hwpxRow": 7, "hwpxCol": 1, "confidence": 2.5 },
  ...
]
```

---

## í•µì‹¬ êµí›ˆ

### 1. ë‹¨ì¼ ë°©ë²•ì˜ í•œê³„

- ê·œì¹™ ê¸°ë°˜: íŒ¨í„´ì´ ë§ì§€ ì•Šìœ¼ë©´ ì‹¤íŒ¨
- AI ë‹¨ë…: í™˜ê°(hallucination) ê°€ëŠ¥ì„±
- ë¬¸ìì—´ ë§¤ì¹­: ì˜ë¯¸ì  ìœ ì‚¬ì„± ë¬´ì‹œ

### 2. ì•™ìƒë¸”ì˜ í˜

```
Rule-based (ì •í™•í•˜ì§€ë§Œ ì œí•œì )
     +
AI Template (êµ¬ì¡° ì´í•´)
     +
AI Excel (ì˜ë¯¸ì  ë§¤ì¹­)
     â†“
íˆ¬í‘œ/í•©ì˜ â†’ ë†’ì€ ì •í™•ë„
```

### 3. ì‹¤ì œ ë°ì´í„°ì˜ ë³µì¡ì„±

- Excel íŒŒì¼ì€ "í‘œì¤€"ì´ ì•„ë‹˜ (í—¤ë” ìœ„ì¹˜, ë³‘í•© ì…€, ì„¹ì…˜ êµ¬ì¡°)
- ìŠ¤ë§ˆíŠ¸ íœ´ë¦¬ìŠ¤í‹±ì´ í•„ìš” (ì ìˆ˜ ê¸°ë°˜ í—¤ë” ê°ì§€)

### 4. ë©”ëª¨ë¦¬ ê´€ë¦¬

- ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ì‹œ ê°ì²´ ì°¸ì¡° ìµœì†Œí™”
- ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ (eachRow) í™œìš©
- ì¡°ê¸° íƒ€ì… ë³€í™˜ìœ¼ë¡œ GC ë¶€ë‹´ ê°ì†Œ

---

## ê¸°ìˆ  ìŠ¤íƒ

- **Backend**: NestJS + TypeScript
- **Excel íŒŒì‹±**: ExcelJS
- **HWPX ì²˜ë¦¬**: adm-zip + fast-xml-parser
- **AI**: Google Gemini API (gemini-2.0-flash)
- **ì•„í‚¤í…ì²˜**: DDD + Clean Architecture
- **íŒ¨í„´**: LangGraph ìŠ¤íƒ€ì¼ ë³‘ë ¬ íŒŒì´í”„ë¼ì¸

---

## ì¶”ê°€ ê°œì„ : í†µí•© API ì•„í‚¤í…ì²˜ (LangGraph ìŠ¤íƒ€ì¼ ë¼ìš°íŒ…)

### ê¸°ì¡´ ë¬¸ì œ

ì´ˆê¸° êµ¬í˜„ì—ì„œëŠ” í…œí”Œë¦¿ í˜•ì‹ë³„ë¡œ ë¶„ë¦¬ëœ API ì—”ë“œí¬ì¸íŠ¸ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤:

```
ê¸°ì¡´ ì•„í‚¤í…ì²˜:

í”„ë¡ íŠ¸ì—”ë“œ
  â”œâ”€ HWPX í…œí”Œë¦¿ â†’ /api/hwpx/generate (NestJS)
  â””â”€ Excel/CSV í…œí”Œë¦¿ â†’ /api/converter/generate (Next.js API Route)
```

ì´ ë°©ì‹ì˜ ë¬¸ì œì :
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í˜•ì‹ë³„ ë¶„ê¸° ë¡œì§ í•„ìš”
- MappingContext(í•„ë“œ ë¨¸ì§€ ê·œì¹™)ê°€ ì¼ë¶€ í˜•ì‹ì—ë§Œ ì ìš©
- ì½”ë“œ ì¤‘ë³µ (ë°ì´í„° ì¶”ì¶œ, ë¨¸ì§€ ë¡œì§ ë“±)

### í•´ê²°: ë‹¨ì¼ ì§„ì…ì  + ë‚´ë¶€ ë¼ìš°íŒ…

LangGraphì˜ **Conditional Edge** íŒ¨í„´ì„ ì ìš©í•˜ì—¬ í†µí•© APIë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤:

```
ê°œì„ ëœ ì•„í‚¤í…ì²˜:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UnifiedGeneratorService                          â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Node 1: Format Detection                                     â”‚   â”‚
â”‚  â”‚   detectFormat(templateFileName)                             â”‚   â”‚
â”‚  â”‚   .hwpx | .xlsx | .xls | .csv â†’ í˜•ì‹ ê²°ì •                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Router Node: Conditional Branch                              â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚   case 'hwpx'  â”€â”€â–º generateHwpx()  â”€â”€â–º HwpxGeneratorService â”‚   â”‚
â”‚  â”‚   case 'xlsx'  â”€â”€â–º generateExcel() â”€â”€â–º ExcelJS + JSZip      â”‚   â”‚
â”‚  â”‚   case 'csv'   â”€â”€â–º generateCsv()   â”€â”€â–º String Buffer        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Shared Node: applyMergeMappings()                            â”‚   â”‚
â”‚  â”‚   ëª¨ë“  í˜•ì‹ì— ê³µí†µìœ¼ë¡œ MappingContext ì ìš©                     â”‚   â”‚
â”‚  â”‚   fieldRelations: sourceFields â†’ targetField ë¨¸ì§€            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                      â”‚
â”‚                              â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Output Node: GenerateResult                                  â”‚   â”‚
â”‚  â”‚   { buffer, contentType, fileName }                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### í•µì‹¬ ì½”ë“œ

```typescript
@Injectable()
export class UnifiedGeneratorService {
  constructor(private readonly hwpxGeneratorService: HwpxGeneratorService) {}

  // ë‹¨ì¼ ì§„ì…ì 
  async generate(params: UnifiedGenerateParams): Promise<GenerateResult> {
    // Node 1: Format Detection
    const templateFormat = this.detectFormat(params.templateFileName);

    // Router Node: Conditional Branch
    switch (templateFormat) {
      case 'hwpx':
        return this.generateHwpx(params);

      case 'xlsx':
      case 'xls':
        return this.generateExcel(params);

      case 'csv':
        return this.generateCsv(params);

      default:
        throw new BadRequestException(`ì§€ì›í•˜ì§€ ì•ŠëŠ” í…œí”Œë¦¿ í˜•ì‹: ${templateFormat}`);
    }
  }

  // ê° ë¸Œëœì¹˜ì—ì„œ ê³µí†µ ë¨¸ì§€ ë¡œì§ í˜¸ì¶œ
  private async generateExcel(params: UnifiedGenerateParams): Promise<GenerateResult> {
    // ... Excel ë¡œë“œ ë° ì²˜ë¦¬

    for (const row of dataRows) {
      // Shared Node: ë¨¸ì§€ ê·œì¹™ ì ìš©
      if (params.mappingContext?.fieldRelations) {
        this.applyMergeMappings(row, params.mappingContext.fieldRelations);
      }
      // ... Excel íŒŒì¼ ìƒì„±
    }
  }
}
```

### MappingContextì™€ í•„ë“œ ë¨¸ì§€

UIì—ì„œ ì •ì˜í•œ í•„ë“œ ê´€ê³„ ê·œì¹™ì„ ëª¨ë“  í…œí”Œë¦¿ í˜•ì‹ì— ì ìš©í•©ë‹ˆë‹¤:

```typescript
interface MappingContext {
  description?: string;
  fieldRelations?: Array<{
    targetField: string;      // ê²°ê³¼ í•„ë“œëª…
    sourceFields: string[];   // ì†ŒìŠ¤ í•„ë“œë“¤
    mergeStrategy?: 'concat' | 'first' | 'all';
  }>;
}

// ì˜ˆì‹œ: "ì „ë¬¸ê°€ ê°•ì—°" + "í•´ì™¸ ê²½ë ¥ì ë©˜í† ë§" â†’ "í•µì‹¬ ì„¸ë¯¸ë‚˜"
{
  targetField: "í•µì‹¬ ì„¸ë¯¸ë‚˜",
  sourceFields: ["ì „ë¬¸ê°€ ê°•ì—°", "í•´ì™¸ ê²½ë ¥ì ë©˜í† ë§"],
  mergeStrategy: "all"  // ê²°ê³¼: "O / O" ë˜ëŠ” "X / O"
}
```

### í†µí•© APIì˜ ì¥ì 

| ê¸°ì¡´ | ê°œì„  í›„ |
|-----|--------|
| í˜•ì‹ë³„ ë¶„ë¦¬ëœ API | ë‹¨ì¼ `/api/generate` ì—”ë“œí¬ì¸íŠ¸ |
| í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ë¶„ê¸° | ë°±ì—”ë“œì—ì„œ ìë™ ë¼ìš°íŒ… |
| MappingContext ì¼ë¶€ ì ìš© | ëª¨ë“  í˜•ì‹ì— ì¼ê´€ë˜ê²Œ ì ìš© |
| ì½”ë“œ ì¤‘ë³µ | ê³µí†µ ë¡œì§ ì¬ì‚¬ìš© |

### LangGraph íŒ¨í„´ê³¼ì˜ ë¹„êµ

ì‹¤ì œ LangGraphë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì§€ë§Œ ë™ì¼í•œ ì„¤ê³„ ì›ì¹™ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤:

```
LangGraph ê°œë…          ìš°ë¦¬ êµ¬í˜„
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
State                   UnifiedGenerateParams
Node                    ê° generate*() ë©”ì„œë“œ
Conditional Edge        switch(templateFormat)
Shared State           MappingContext
Output                 GenerateResult
```

ì´ íŒ¨í„´ì˜ í•µì‹¬ì€ **ë‹¨ì¼ ì§„ì…ì  â†’ ì¡°ê±´ë¶€ ë¶„ê¸° â†’ ê³µí†µ í›„ì²˜ë¦¬ â†’ í†µí•© ì¶œë ¥**ì…ë‹ˆë‹¤.

---

## Agent ê¸°ë°˜ ì•„í‚¤í…ì²˜ë¡œì˜ ì§„í™”

### ìƒˆë¡œìš´ ë¬¸ì œ: ë³µì¡í•œ ë‹¤ì¤‘ í—¤ë” Excel

ê¸°ì¡´ ì‹œìŠ¤í…œì€ ë‹¨ìˆœí•œ í—¤ë” êµ¬ì¡°(1í–‰ í—¤ë”)ë¥¼ ê°€ì •í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ë¬´ì—ì„œëŠ” í›¨ì”¬ ë³µì¡í•œ êµ¬ì¡°ê°€ ë“±ì¥í–ˆìŠµë‹ˆë‹¤:

```
ì¿ íŒ¡ ì¶œê²° Excel êµ¬ì¡°:

Row 1-8:  ë©”íƒ€ ì •ë³´ (Class Name, Book Name, Teacher Name ë“±)
Row 9:    ì›” í—¤ë”       | 8ì›”    | 8ì›”    | 8ì›”    | 9ì›”    | 9ì›”    |
Row 10:   íšŒì°¨ í—¤ë”     | 1íšŒì°¨  | 2íšŒì°¨  | 3íšŒì°¨  | 1íšŒì°¨  | 2íšŒì°¨  |
Row 11:   ë‚ ì§œ í—¤ë”     | 04(Mo) | 06(We) | 08(Fr) | 01(Mo) | 03(We) |
Row 12+:  ë°ì´í„°
```

```
ë¦¬í„´ì—… Excel êµ¬ì¡°:

Row 1:    ëŒ€ë¶„ë¥˜        | 4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©  | 4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©  | ...
Row 2:    ì¤‘ë¶„ë¥˜        | ì „ë¬¸ê°€ ê°•ì—°          | ì „ë¬¸ê°€ ê°•ì—°          | ì „ë¬¸ê°€ ì»¨ì„¤íŒ… | ...
Row 3:    ì†Œë¶„ë¥˜ + ê¸°ë³¸ | No. | ì„±ëª… | 1íšŒ | 2íšŒ | 3íšŒ | 1íšŒ | 2íšŒ | ...
Row 4+:   ë°ì´í„°
```

**í•µì‹¬ ë¬¸ì œ**: "1íšŒ", "2íšŒ" ê°™ì€ ì»¬ëŸ¼ëª…ì´ **ì—¬ëŸ¬ í”„ë¡œê·¸ë¨ì—ì„œ ì¤‘ë³µ**ë˜ì–´ ì–´ë–¤ í”„ë¡œê·¸ë¨ì¸ì§€ êµ¬ë¶„ì´ ì•ˆë¨!

### ê¸°ì¡´ ë°©ì‹ì˜ í•œê³„

ê¸°ì¡´ `findSmartHeaderRow` í•¨ìˆ˜ëŠ” **ë‹¨ì¼ í—¤ë” í–‰**ë§Œ ì°¾ì•˜ìŠµë‹ˆë‹¤:

```typescript
// ê¸°ì¡´: ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ë‹¨ì¼ í–‰ë§Œ ì„ íƒ
const headerRow = scores.sort((a, b) => b.score - a.score)[0];
```

ê²°ê³¼ì ìœ¼ë¡œ:
- Row 3ë§Œ í—¤ë”ë¡œ ì¸ì‹
- ì»¬ëŸ¼ëª…: `"1íšŒ"`, `"2íšŒ"`, `"3íšŒ"` (í”„ë¡œê·¸ë¨ êµ¬ë¶„ ì—†ìŒ)
- AI ë§¤í•‘ ì‹œ "ì „ë¬¸ê°€ ì»¨ì„¤íŒ… 1íšŒ"ì™€ "ì‹¤ì „ëª¨ì˜ë©´ì ‘ 1íšŒ"ë¥¼ êµ¬ë¶„ ë¶ˆê°€

### í•´ê²°: HeaderDetectionAgent ë„ì…

**Agent íŒ¨í„´**ì„ ì ìš©í•˜ì—¬ ë³µì¡í•œ í—¤ë” êµ¬ì¡°ë¥¼ ììœ¨ì ìœ¼ë¡œ ë¶„ì„í•˜ëŠ” ì „ë¬¸ Agentë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       HeaderDetectionAgent                               â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Step 1: detectMetaRows()                                          â”‚ â”‚
â”‚  â”‚   "Class Name : xxx", "Book Name : xxx" íŒ¨í„´ ê°ì§€                 â”‚ â”‚
â”‚  â”‚   â†’ metaRows: [1, 2, 3, 4, 5, 6, 7, 8]                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Step 2: detectHeaderRows()                                        â”‚ â”‚
â”‚  â”‚   ì ìˆ˜ ê¸°ë°˜ ë©”ì¸ í—¤ë” ì°¾ê¸° + ìœ„/ì•„ë˜ ì¶”ê°€ í—¤ë” ê°ì§€               â”‚ â”‚
â”‚  â”‚   â†’ headerRows: [1, 2, 3] (ë‹¤ì¤‘ í–‰!)                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Step 3: extractMergeInfo()                                        â”‚ â”‚
â”‚  â”‚   ë³‘í•© ì…€ ì •ë³´ ì¶”ì¶œ (ì–´ë–¤ ì…€ì´ ì–´ë””ê¹Œì§€ ë³‘í•©ë˜ì—ˆëŠ”ì§€)               â”‚ â”‚
â”‚  â”‚   â†’ merges: [{startCol:17, endCol:22, text:"ì „ë¬¸ê°€ ê°•ì—°"}, ...]   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Step 4: generateHierarchicalColumns()                             â”‚ â”‚
â”‚  â”‚   ë‹¤ì¤‘ í—¤ë” í–‰ ê°’ì„ ê³„ì¸µì ìœ¼ë¡œ ì¡°í•©                                â”‚ â”‚
â”‚  â”‚   Row1 + Row2 + Row3 â†’ "4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_1íšŒ"     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                                          â”‚
â”‚                              â–¼                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Output: HeaderAnalysisResult                                       â”‚ â”‚
â”‚  â”‚   headerRows: [1, 2, 3]                                           â”‚ â”‚
â”‚  â”‚   dataStartRow: 4                                                 â”‚ â”‚
â”‚  â”‚   columns: [                                                      â”‚ â”‚
â”‚  â”‚     { name: "No.", colIndex: 2 },                                 â”‚ â”‚
â”‚  â”‚     { name: "ì„±ëª…", colIndex: 3 },                                â”‚ â”‚
â”‚  â”‚     { name: "4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_1íšŒ", colIndex: 17 },â”‚ â”‚
â”‚  â”‚     { name: "4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_2íšŒ", colIndex: 18 },â”‚ â”‚
â”‚  â”‚     { name: "4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ì»¨ì„¤íŒ…_1íšŒ", colIndex: 29},â”‚ â”‚
â”‚  â”‚     ...                                                           â”‚ â”‚
â”‚  â”‚   ]                                                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ê³„ì¸µì  ì»¬ëŸ¼ëª… ìƒì„± ì•Œê³ ë¦¬ì¦˜

í•µì‹¬ì€ **ê° ì»¬ëŸ¼ë³„ë¡œ ëª¨ë“  í—¤ë” í–‰ì˜ ê°’ì„ ìˆ˜ì§‘í•˜ê³  ì¡°í•©**í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤:

```typescript
private generateHierarchicalColumns(
  worksheet: ExcelJS.Worksheet,
  headerRows: number[],
  merges: MergeInfo[]
): HierarchicalColumn[] {
  // ê° ì»¬ëŸ¼ë³„ë¡œ í–‰ ìˆœì„œëŒ€ë¡œ ê°’ ìˆ˜ì§‘
  const columnValuesPerRow = new Map<number, Map<number, string>>();

  for (const rowNum of headerRows) {
    const row = worksheet.getRow(rowNum);
    row.eachCell((cell, colNumber) => {
      const text = this.getCellText(cell).trim();
      if (!columnValuesPerRow.has(colNumber)) {
        columnValuesPerRow.set(colNumber, new Map());
      }
      columnValuesPerRow.get(colNumber)!.set(rowNum, text);
    });
  }

  // ë³‘í•© ì…€ ì²˜ë¦¬: ë³‘í•© ë²”ìœ„ ë‚´ ëª¨ë“  ì»¬ëŸ¼ì— ê°’ ì „íŒŒ
  for (const merge of merges) {
    for (let col = merge.startCol; col <= merge.endCol; col++) {
      const colMap = columnValuesPerRow.get(col);
      if (colMap && !colMap.has(merge.startRow)) {
        colMap.set(merge.startRow, merge.text);
      }
    }
  }

  // ê³„ì¸µì  ì´ë¦„ ì¡°í•©
  for (const [colNumber, rowValues] of columnValuesPerRow) {
    const sortedRows = Array.from(rowValues.keys()).sort();
    const orderedValues = sortedRows.map(r => rowValues.get(r)!);

    // ê¸°ë³¸ ì»¬ëŸ¼ (No., ì„±ëª… ë“±)ì€ ë‹¨ì¼ ê°’ ì‚¬ìš©
    if (this.isBasicColumn(orderedValues)) {
      finalName = orderedValues[orderedValues.length - 1];
    } else {
      // ë‹¤ì¤‘ í—¤ë”: ê³„ì¸µ ì¡°í•©
      // ["4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©", "ì „ë¬¸ê°€ ê°•ì—°", "1íšŒ"]
      // â†’ "4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_1íšŒ"
      finalName = orderedValues.filter(v => !this.isFiltered(v)).join('_');
    }
  }
}
```

### ê²°ê³¼ ë¹„êµ

| ì´ì „ | Agent ì ìš© í›„ |
|------|--------------|
| `1íšŒ` | `4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_1íšŒ` |
| `2íšŒ` | `4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_2íšŒ` |
| `1íšŒ` (ì¤‘ë³µ!) | `4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ì»¨ì„¤íŒ…_1íšŒ` |
| `1íšŒ` (ì¤‘ë³µ!) | `4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì‹¤ì „ëª¨ì˜ë©´ì ‘_1íšŒ` |

**51ê°œ ì»¬ëŸ¼ ëª¨ë‘ ê³ ìœ í•œ ì´ë¦„ìœ¼ë¡œ êµ¬ë¶„ë¨!**

---

## OrchestratorAgent: ë‹¤ì¤‘ Agent í˜‘ì—…

ë³µì¡í•œ ë¬¸ì„œ ë³€í™˜ ì‘ì—…ì„ ì—¬ëŸ¬ ì „ë¬¸ Agentê°€ í˜‘ì—…í•˜ì—¬ ì²˜ë¦¬í•©ë‹ˆë‹¤:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        OrchestratorAgent                                 â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Agent Registry                                                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   HeaderDetectionAgent â”€â”€â”€ Excel í—¤ë” êµ¬ì¡° ë¶„ì„ ì „ë¬¸ê°€           â”‚   â”‚
â”‚  â”‚   RuleBasedMappingNode â”€â”€â”€ ê·œì¹™ ê¸°ë°˜ ë§¤í•‘ (ê¸°ì¡´)                 â”‚   â”‚
â”‚  â”‚   AiTemplateMappingNode â”€â”€ AI í…œí”Œë¦¿ ë¶„ì„ (ê¸°ì¡´)                 â”‚   â”‚
â”‚  â”‚   AiExcelMappingNode â”€â”€â”€â”€â”€ AI Excel ì‹œë§¨í‹± ë§¤ì¹­ (ê¸°ì¡´)           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Orchestration Flow                                               â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   1. HeaderDetectionAgent.analyze(excelBuffer)                   â”‚   â”‚
â”‚  â”‚      â””â”€â†’ { headerRows, dataStartRow, columns }                   â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   2. Promise.allSettled([                                        â”‚   â”‚
â”‚  â”‚        runRuleBasedMapping(columns),                             â”‚   â”‚
â”‚  â”‚        runAiTemplateAnalysis(hwpxTable),                         â”‚   â”‚
â”‚  â”‚        runAiExcelAnalysis(columns, hwpxLabels)                   â”‚   â”‚
â”‚  â”‚      ])                                                          â”‚   â”‚
â”‚  â”‚      â””â”€â†’ ë³‘ë ¬ ì‹¤í–‰, ì‹¤íŒ¨í•´ë„ ê³„ì† ì§„í–‰                            â”‚   â”‚
â”‚  â”‚                                                                  â”‚   â”‚
â”‚  â”‚   3. mergeMappings(allCandidates)                                â”‚   â”‚
â”‚  â”‚      â””â”€â†’ íˆ¬í‘œ ê¸°ë°˜ ìµœì¢… ë§¤í•‘ ê²°ì •                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent vs Nodeì˜ ì°¨ì´

| LangGraph Node | Agent |
|----------------|-------|
| ë‹¨ì¼ ì‘ì—… ìˆ˜í–‰ | ììœ¨ì  íŒë‹¨ + ì‘ì—… ìˆ˜í–‰ |
| ê³ ì •ëœ ì…ì¶œë ¥ | ìƒí™©ì— ë”°ë¼ ë‹¤ë¥¸ ì „ëµ ì„ íƒ |
| ìˆ˜ë™ ì—°ê²° | ìŠ¤ìŠ¤ë¡œ í•„ìš”í•œ ì •ë³´ ìš”ì²­ |

HeaderDetectionAgentëŠ” ë‹¨ìˆœíˆ "í—¤ë” í–‰ ë²ˆí˜¸ë¥¼ ë°˜í™˜"í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼:
- ë©”íƒ€ í–‰ íŒ¨í„´ ìë™ ê°ì§€
- ë‹¤ì¤‘ í—¤ë” êµ¬ì¡° íŒë‹¨
- ë³‘í•© ì…€ ì²˜ë¦¬ ì „ëµ ê²°ì •
- ê³„ì¸µì  ì´ë¦„ ìƒì„± ê·œì¹™ ì ìš©

---

## ì‹¤ì œ ì ìš© ê²°ê³¼: ë¦¬í„´ì—… ë°ì´í„° ì¼ê´„ ìƒì„±

### í…ŒìŠ¤íŠ¸ í™˜ê²½
- **í…œí”Œë¦¿**: ê°œì¸ì´ë ¥ì¹´ë“œ.hwpx (28í–‰ Ã— 16ì—´ í‘œ)
- **ë°ì´í„°**: ë¦¬í„´ì—… ëª…ë‹¨.xlsx (383ëª…, 51ê°œ ì»¬ëŸ¼, 3í–‰ ë‹¤ì¤‘ í—¤ë”)

### ìƒì„± ê³¼ì •

```
1. HeaderDetectionAgent ë¶„ì„
   - headerRows: [1, 2, 3]
   - dataStartRow: 4
   - columns: 51ê°œ (ê³„ì¸µì  ì´ë¦„)

2. AI ìë™ ë§¤í•‘ (38ê°œ í•„ë“œ ë§¤í•‘)
   - ì„±ëª… â†’ Row 3, Col 1
   - ì—°ë½ì²˜ â†’ Row 4, Col 1
   - 4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_1íšŒ â†’ Row 19, Col 0
   - 4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ì»¨ì„¤íŒ…_1íšŒ â†’ Row 14, Col 2
   - ...

3. HWPX ì¼ê´„ ìƒì„±
   - 383ê°œ íŒŒì¼ ìƒì„± (fallback ì œì™¸)
   - íŒŒì¼ëª…: í•œê¸€ ì´ë¦„ ê¸°ë°˜ (ê°•ë‚˜í¬.hwpx, ê¹€ë™í™˜.hwpx, ...)
```

### ìƒì„±ëœ íŒŒì¼ ê²€ì¦

```
ğŸ“„ ê°•ë‚˜í¬.hwpx
----------------------------------------
ê°œì¸ì´ë ¥ì¹´ë“œ
1. ì‹ ìƒì •ë³´
ì„±  ëª…: ê°•ë‚˜í¬
ìƒë…„ì›”ì¼: 2000-08-30
ì„±  ë³„: ì—¬ì„±
ì—°ë½ì²˜: 01092316315
ì´ë©”ì¼: 0830kknn@gmail.com
2. í•´ì™¸ì·¨ì—…(ê²½í—˜)
ì°¸ì—¬ë¶„ì•¼: ê³µë‹¨ì‚¬ì—…
ìˆ˜í–‰ê¸°ê´€: (ì£¼)ë¦¬ì–¼ìŠ¤í†¤
ì‚¬ì—…ëª…: [ìš°ìˆ˜ê³¼ì •]ë¯¸êµ­ì·¨ì—… e-Biz ì‹¤ë¬´ì ì–‘ì„±ê³¼ì • 9ê¸°
êµ­ê°€: ë¯¸êµ­
...
```

### ì„±ëŠ¥ ì§€í‘œ

| ì§€í‘œ | ê²°ê³¼ |
|-----|------|
| ì´ íŒŒì¼ ìƒì„± | 383ê°œ |
| ë§¤í•‘ í•„ë“œ | 38ê°œ |
| ìƒì„± ì‹œê°„ | ~45ì´ˆ |
| ZIP í¬ê¸° | 22.55 MB |
| ë°ì´í„° ì •í™•ë„ | 100% |

---

## Agent ì•„í‚¤í…ì²˜ì˜ ì¥ì 

### 1. í™•ì¥ì„±

ìƒˆë¡œìš´ Excel í˜•ì‹ì´ ë“±ì¥í•´ë„ ê¸°ì¡´ Agentë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ìƒˆ Agent ì¶”ê°€ ê°€ëŠ¥:

```typescript
// ë¯¸ë˜: ìƒˆë¡œìš´ í˜•ì‹ ì§€ì›
orchestrator.registerAgent('pdf', new PdfTemplateAgent());
orchestrator.registerAgent('docx', new DocxTemplateAgent());
```

### 2. ë…ë¦½ì  í…ŒìŠ¤íŠ¸

ê° Agentë¥¼ ë…ë¦½ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ê³  ê°œì„  ê°€ëŠ¥:

```typescript
// HeaderDetectionAgent ë‹¨ë… í…ŒìŠ¤íŠ¸
const result = await headerAgent.analyze(excelBuffer);
expect(result.columns).toContain('4. í”„ë¡œê·¸ë¨ ì°¸ì—¬í˜„í™©_ì „ë¬¸ê°€ ê°•ì—°_1íšŒ');
```

### 3. ì¥ì•  ê²©ë¦¬

í•œ Agentê°€ ì‹¤íŒ¨í•´ë„ ë‹¤ë¥¸ Agentì˜ ê²°ê³¼ë¡œ ë³´ì™„:

```typescript
const results = await Promise.allSettled([
  ruleBasedAgent.run(),    // ì„±ê³µ: 27ê°œ
  aiTemplateAgent.run(),   // ì‹¤íŒ¨: API íƒ€ì„ì•„ì›ƒ
  aiExcelAgent.run()       // ì„±ê³µ: 13ê°œ
]);
// â†’ 40ê°œ ë§¤í•‘ìœ¼ë¡œ ê³„ì† ì§„í–‰ (AI í…œí”Œë¦¿ ì—†ì´ë„ ë™ì‘)
```

### 4. ì ì§„ì  ê°œì„ 

Agentë³„ë¡œ ë…ë¦½ì ì¸ ë²„ì „ ê´€ë¦¬ ë° A/B í…ŒìŠ¤íŠ¸ ê°€ëŠ¥:

```typescript
// v1: ë‹¨ìˆœ í—¤ë” ê°ì§€
// v2: ë‹¤ì¤‘ í—¤ë” ì§€ì› (í˜„ì¬)
// v3: AI ê¸°ë°˜ í—¤ë” ì¶”ë¡  (ê³„íš)
const headerAgent = new HeaderDetectionAgentV2();
```

---

## ê²°ë¡ : Graphì—ì„œ Agentë¡œ

| ë‹¨ê³„ | ì ‘ê·¼ ë°©ì‹ | ë¬¸ì œ í•´ê²° |
|-----|---------|----------|
| 1ì°¨ | ë‹¨ìˆœ íŒŒì‹± | ë¹„í‘œì¤€ Excel êµ¬ì¡° ì‹¤íŒ¨ |
| 2ì°¨ | ìŠ¤ë§ˆíŠ¸ íœ´ë¦¬ìŠ¤í‹± | ë‹¨ì¼ í—¤ë”ë§Œ ì²˜ë¦¬ |
| 3ì°¨ | ë¬¸ìì—´ ë§¤ì¹­ | ì˜ë¯¸ì  ìœ ì‚¬ì„± ë¬´ì‹œ |
| 4ì°¨ | **LangGraph ìŠ¤íƒ€ì¼** | ë³‘ë ¬ ì „ëµ + íˆ¬í‘œ |
| **5ì°¨** | **Agent ê¸°ë°˜** | **ë‹¤ì¤‘ í—¤ë” + ììœ¨ì  íŒë‹¨** |

**í•µì‹¬ êµí›ˆ**:
1. **ì‹¤ì œ ë°ì´í„°ëŠ” ì˜ˆìƒë³´ë‹¤ ë³µì¡**í•˜ë‹¤ (ë‹¤ì¤‘ í—¤ë”, ë³‘í•© ì…€, ë©”íƒ€ í–‰)
2. **ë‹¨ì¼ ì•Œê³ ë¦¬ì¦˜ë³´ë‹¤ ì „ë¬¸ Agent í˜‘ì—…**ì´ íš¨ê³¼ì ì´ë‹¤
3. **AgentëŠ” ë‹¨ìˆœ í•¨ìˆ˜ê°€ ì•„ë‹ˆë¼ ììœ¨ì  íŒë‹¨ ëŠ¥ë ¥**ì„ ê°€ì§„ë‹¤
4. **ì ì§„ì  ì§„í™”**ê°€ ê°€ëŠ¥í•œ ì•„í‚¤í…ì²˜ê°€ ì¤‘ìš”í•˜ë‹¤

---

## ê¸°ìˆ  ìŠ¤íƒ (ìµœì¢…)

- **Backend**: NestJS + TypeScript
- **Excel íŒŒì‹±**: ExcelJS
- **HWPX ì²˜ë¦¬**: adm-zip + fast-xml-parser
- **AI**: Google Gemini API (gemini-2.0-flash)
- **ì•„í‚¤í…ì²˜**: DDD + Clean Architecture + **Agent Pattern**
- **íŒ¨í„´**: LangGraph ìŠ¤íƒ€ì¼ â†’ **Multi-Agent Orchestration**

---

## ì°¸ê³  ìë£Œ

- [LangGraph Documentation](https://langchain-ai.github.io/langgraph/)
- [ExcelJS GitHub](https://github.com/exceljs/exceljs)
- [HWPX íŒŒì¼ í˜•ì‹ ë¶„ì„](https://www.hancom.com/)
- [Gemini API Documentation](https://ai.google.dev/docs)
- [Multi-Agent Systems](https://en.wikipedia.org/wiki/Multi-agent_system)
